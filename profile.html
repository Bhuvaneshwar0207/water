<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - AquaStore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Sticky Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-tint"></i> AquaStore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="product_list.html">
                            <i class="fas fa-shopping-bag"></i> Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cart.html">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cartBadge">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="orders.html">
                            <i class="fas fa-box"></i> My Orders
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> <span id="navUserName">Account</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="profile.html">
                                <i class="fas fa-user-edit"></i> My Profile
                            </a></li>
                            <li><a class="dropdown-item" href="wishlist.html">
                                <i class="fas fa-heart"></i> Wishlist
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Profile Section -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <!-- Profile Information -->
                <div class="col-lg-8">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4>Personal Information</h4>
                                <button class="btn btn-outline-primary" onclick="toggleEditMode()">
                                    <i class="fas fa-edit"></i> Edit Profile
                                </button>
                            </div>
                            
                            <form id="profileForm" onsubmit="updateProfile(event)">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="fullName" class="form-label">Full Name</label>
                                        <input type="text" class="form-control" id="fullName" disabled>
                                        <div class="error-message" id="fullNameError"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="email" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" disabled>
                                        <div class="error-message" id="emailError"></div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="phone" class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" disabled>
                                        <div class="error-message" id="phoneError"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="profileImage" class="form-label">Profile Picture</label>
                                        <input type="file" class="form-control" id="profileImage" accept="image/*" disabled>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bio" class="form-label">Bio</label>
                                    <textarea class="form-control" id="bio" rows="3" placeholder="Tell us about yourself..." disabled></textarea>
                                </div>
                                
                                <div id="editActions" style="display: none;">
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i> Save Changes
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="cancelEdit()">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Addresses Section -->
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4>Delivery Addresses</h4>
                                <button class="btn btn-primary" onclick="showAddAddressForm()">
                                    <i class="fas fa-plus"></i> Add Address
                                </button>
                            </div>
                            
                            <div id="addressesList">
                                <!-- Addresses will be loaded by JavaScript -->
                            </div>
                            
                            <!-- Add Address Form (Hidden by default) -->
                            <div id="addAddressForm" style="display: none;" class="mt-4 p-3 bg-light rounded">
                                <h5 class="mb-3">Add New Address</h5>
                                <form onsubmit="addAddress(event)">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="addressName" class="form-label">Address Name</label>
                                            <input type="text" class="form-control" id="addressName" placeholder="Home Address" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="addressPhone" class="form-label">Phone</label>
                                            <input type="tel" class="form-control" id="addressPhone" placeholder="+91 98765 43210" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="addressLine1" class="form-label">Address Line 1</label>
                                        <input type="text" class="form-control" id="addressLine1" placeholder="Street Address" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="addressLine2" class="form-label">Address Line 2</label>
                                        <input type="text" class="form-control" id="addressLine2" placeholder="Apartment, Suite, etc.">
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="addressCity" class="form-label">City</label>
                                            <input type="text" class="form-control" id="addressCity" placeholder="Mumbai" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="addressState" class="form-label">State</label>
                                            <input type="text" class="form-control" id="addressState" placeholder="Maharashtra" required>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="addressPincode" class="form-label">PIN Code</label>
                                            <input type="text" class="form-control" id="addressPincode" placeholder="400001" maxlength="6" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="isDefault">
                                            <label class="form-check-label" for="isDefault">
                                                Set as Default Address
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i> Save Address
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="hideAddAddressForm()">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Profile Summary -->
                    <div class="card mb-4">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <img src="https://via.placeholder.com/100x100/007BFF/ffffff?text=Profile" alt="Profile" class="rounded-circle" style="width: 100px; height: 100px;">
                            </div>
                            <h5 id="sidebarName">John Doe</h5>
                            <p class="text-muted" id="sidebarEmail">john@example.com</p>
                            <small class="text-muted">Member since: <span id="memberSince">2024</span></small>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h6 class="card-title">Quick Stats</h6>
                            <div class="mb-2">
                                <small class="text-muted">Total Orders</small>
                                <h5 id="totalOrders">0</h5>
                            </div>
                            <div class="mb-2">
                                <small class="text-muted">Saved Addresses</small>
                                <h5 id="totalAddresses">0</h5>
                            </div>
                            <div>
                                <small class="text-muted">Wishlist Items</small>
                                <h5 id="totalWishlist">0</h5>
                            </div>
                        </div>
                    </div>

                    <!-- Account Actions -->
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title mb-3">Account Actions</h6>
                            <div class="d-grid gap-2">
                                <a href="orders.html" class="btn btn-outline-primary w-100">
                                    <i class="fas fa-box"></i> Order History
                                </a>
                                <a href="wishlist.html" class="btn btn-outline-primary w-100">
                                    <i class="fas fa-heart"></i> My Wishlist
                                </a>
                                <a href="settings.html" class="btn btn-outline-primary w-100">
                                    <i class="fas fa-cog"></i> Settings
                                </a>
                                <button class="btn btn-outline-danger w-100" onclick="confirmDeleteAccount()">
                                    <i class="fas fa-trash"></i> Delete Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-tint"></i> AquaStore</h5>
                    <p>Your trusted partner for clean water delivery</p>
                </div>
                <div class="col-md-6 text-end">
                    <p>&copy; 2024 AquaStore. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        let addresses = [];
        let isEditMode = false;
        let editingAddressId = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadUserFromStorage();
            updateCartBadge();
            loadProfile();
            loadAddresses();
            updateSidebarStats();
            
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }
        });

        function loadProfile() {
            if (currentUser) {
                document.getElementById('fullName').value = currentUser.fullName || '';
                document.getElementById('email').value = currentUser.email || '';
                document.getElementById('phone').value = currentUser.phone || '';
                document.getElementById('bio').value = currentUser.bio || '';
                document.getElementById('navUserName').textContent = currentUser.fullName || currentUser.email;
                document.getElementById('sidebarName').textContent = currentUser.fullName || 'User';
                document.getElementById('sidebarEmail').textContent = currentUser.email;
                document.getElementById('memberSince').textContent = new Date(currentUser.createdAt).getFullYear();
            }
        }

        function loadAddresses() {
            const savedAddresses = localStorage.getItem('aquaStoreAddresses');
            if (savedAddresses) {
                addresses = JSON.parse(savedAddresses);
            }
            renderAddresses();
        }

        function renderAddresses() {
            const container = document.getElementById('addressesList');
            
            if (addresses.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-map-marker-alt fa-2x text-muted mb-3"></i>
                        <p class="text-muted">No addresses added yet. Add your first delivery address!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = addresses.map(address => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">${address.name}</h6>
                                <p class="mb-1">${address.phone}</p>
                                <p class="mb-1">${address.addressLine1}</p>
                                ${address.addressLine2 ? `<p class="mb-1">${address.addressLine2}</p>` : ''}
                                <p class="mb-1">${address.city}, ${address.state} - ${address.pincode}</p>
                                ${address.isDefault ? '<span class="badge bg-primary">Default</span>' : ''}
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="editAddress('${address.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteAddress('${address.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                ${!address.isDefault ? `<button class="btn btn-sm btn-outline-success" onclick="setDefaultAddress('${address.id}')">
                                    <i class="fas fa-check"></i> Set Default
                                </button>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const formFields = ['fullName', 'email', 'phone', 'bio'];
            const editActions = document.getElementById('editActions');
            
            formFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.disabled = !isEditMode;
                }
            });
            
            editActions.style.display = isEditMode ? 'block' : 'none';
        }

        function cancelEdit() {
            loadProfile(); // Reset to original values
            toggleEditMode();
        }

        function updateProfile(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const bio = document.getElementById('bio').value;
            
            // Validation
            let isValid = true;
            if (!fullName.trim()) {
                document.getElementById('fullNameError').textContent = 'Name is required';
                isValid = false;
            } else {
                document.getElementById('fullNameError').textContent = '';
            }
            
            if (!email.trim() || !isValidEmail(email)) {
                document.getElementById('emailError').textContent = 'Valid email is required';
                isValid = false;
            } else {
                document.getElementById('emailError').textContent = '';
            }
            
            if (!isValid) return;
            
            // Update user object
            currentUser.fullName = fullName;
            currentUser.email = email;
            currentUser.phone = phone;
            currentUser.bio = bio;
            
            // Save to localStorage
            localStorage.setItem('aquaStoreCurrentUser', JSON.stringify(currentUser));
            
            // Update UI
            loadProfile();
            toggleEditMode();
            showNotification('Profile updated successfully!', 'success');
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function showAddAddressForm() {
            document.getElementById('addAddressForm').style.display = 'block';
            clearAddressForm();
        }

        function hideAddAddressForm() {
            document.getElementById('addAddressForm').style.display = 'none';
            clearAddressForm();
        }

        function clearAddressForm() {
            document.getElementById('addressName').value = '';
            document.getElementById('addressPhone').value = '';
            document.getElementById('addressLine1').value = '';
            document.getElementById('addressLine2').value = '';
            document.getElementById('addressCity').value = '';
            document.getElementById('addressState').value = '';
            document.getElementById('addressPincode').value = '';
            document.getElementById('isDefault').checked = false;
        }

        function addAddress(event) {
            event.preventDefault();
            
            const address = {
                id: 'addr_' + Date.now(),
                name: document.getElementById('addressName').value,
                phone: document.getElementById('addressPhone').value,
                addressLine1: document.getElementById('addressLine1').value,
                addressLine2: document.getElementById('addressLine2').value,
                city: document.getElementById('addressCity').value,
                state: document.getElementById('addressState').value,
                pincode: document.getElementById('addressPincode').value,
                isDefault: document.getElementById('isDefault').checked
            };
            
            // If setting as default, remove default from others
            if (address.isDefault) {
                addresses.forEach(addr => addr.isDefault = false);
            }
            
            addresses.push(address);
            saveAddresses();
            renderAddresses();
            hideAddAddressForm();
            updateSidebarStats();
            showNotification('Address added successfully!', 'success');
        }

        function editAddress(addressId) {
            const address = addresses.find(addr => addr.id === addressId);
            if (!address) return;
            
            editingAddressId = addressId;
            
            // Populate form
            document.getElementById('addressName').value = address.name;
            document.getElementById('addressPhone').value = address.phone;
            document.getElementById('addressLine1').value = address.addressLine1;
            document.getElementById('addressLine2').value = address.addressLine2 || '';
            document.getElementById('addressCity').value = address.city;
            document.getElementById('addressState').value = address.state;
            document.getElementById('addressPincode').value = address.pincode;
            document.getElementById('isDefault').checked = address.isDefault;
            
            // Show form
            document.getElementById('addAddressForm').style.display = 'block';
            
            // Change button text
            const submitBtn = document.querySelector('#addAddressForm button[type="submit"]');
            if (submitBtn) {
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Address';
            }
        }

        function deleteAddress(addressId) {
            if (confirm('Are you sure you want to delete this address?')) {
                addresses = addresses.filter(addr => addr.id !== addressId);
                saveAddresses();
                renderAddresses();
                updateSidebarStats();
                showNotification('Address deleted successfully!', 'success');
            }
        }

        function setDefaultAddress(addressId) {
            addresses.forEach(addr => {
                addr.isDefault = addr.id === addressId;
            });
            saveAddresses();
            renderAddresses();
            showNotification('Default address updated!', 'success');
        }

        function saveAddresses() {
            localStorage.setItem('aquaStoreAddresses', JSON.stringify(addresses));
        }

        function updateSidebarStats() {
            document.getElementById('totalAddresses').textContent = addresses.length;
            
            // Load orders count (mock for now)
            const orders = JSON.parse(localStorage.getItem('aquaStoreOrders') || '[]');
            document.getElementById('totalOrders').textContent = orders.length;
            
            // Load wishlist count (mock for now)
            const wishlist = JSON.parse(localStorage.getItem('aquaStoreWishlist') || '[]');
            document.getElementById('totalWishlist').textContent = wishlist.length;
        }

        function confirmDeleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                // Clear all user data
                localStorage.removeItem('aquaStoreCurrentUser');
                localStorage.removeItem('aquaStoreAddresses');
                localStorage.removeItem('aquaStoreOrders');
                localStorage.removeItem('aquaStoreWishlist');
                
                showNotification('Account deleted successfully!', 'success');
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear current user session
                localStorage.removeItem('aquaStoreCurrentUser');
                
                showNotification('Logged out successfully!', 'success');
                
                // Redirect to index page
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            }
        }
    </script>
</body>
</html>
